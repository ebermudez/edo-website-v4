{% comment %}
Share buttons component for Hydejack
Uses native Web Share API when available, with fallback to direct share links
{% endcomment %}

<div class="share-buttons mb6" style="text-align: center; padding: 1.5rem 0;">
  <p style="margin-bottom: 1rem; color: var(--gray); font-size: smaller;">Share this post:</p>
  
  <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem;">
    {% comment %} Native Share Button (shows on supported browsers) {% endcomment %}
    <button 
      data-action="share-native"
      class="share-button-native"
      style="display: none; padding: 0.5rem 1rem; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; transition: opacity 0.2s;"
      onmouseover="this.style.opacity='0.8'"
      onmouseout="this.style.opacity='1'">
      <span class="icon-new-tab" style="margin-right: 0.25rem;"></span> Share
    </button>
    
    {% comment %} Twitter/X Share {% endcomment %}
    <a 
      href="https://twitter.com/intent/tweet" 
      data-action="share-twitter"
      target="_blank" 
      rel="noopener noreferrer"
      class="share-button share-twitter"
      style="display: inline-block; padding: 0.5rem 1rem; background: #1DA1F2; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem; transition: opacity 0.2s;"
      onmouseover="this.style.opacity='0.8'"
      onmouseout="this.style.opacity='1'">
      <span class="icon-twitter" style="margin-right: 0.25rem;"></span> Twitter
    </a>
    
    {% comment %} LinkedIn Share {% endcomment %}
    <a 
      href="https://www.linkedin.com/sharing/share-offsite/" 
      data-action="share-linkedin"
      target="_blank" 
      rel="noopener noreferrer"
      class="share-button share-linkedin"
      style="display: inline-block; padding: 0.5rem 1rem; background: #0077B5; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem; transition: opacity 0.2s;"
      onmouseover="this.style.opacity='0.8'"
      onmouseout="this.style.opacity='1'">
      <span class="icon-linkedin2" style="margin-right: 0.25rem;"></span> LinkedIn
    </a>
    
    {% comment %} WhatsApp Share {% endcomment %}
    <a 
      href="https://wa.me/" 
      data-action="share-whatsapp"
      target="_blank" 
      rel="noopener noreferrer"
      class="share-button share-whatsapp"
      style="display: inline-block; padding: 0.5rem 1rem; background: #25D366; color: white; text-decoration: none; border-radius: 4px; font-size: 0.9rem; transition: opacity 0.2s;"
      onmouseover="this.style.opacity='0.8'"
      onmouseout="this.style.opacity='1'">
      <span class="icon-whatsapp" style="margin-right: 0.25rem;"></span> WhatsApp
    </a>

    {% comment %} Copy Link Button {% endcomment %}
    <button 
      data-action="copy-link"
      class="share-button share-copy"
      style="padding: 0.5rem 1rem; background: var(--gray); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; transition: opacity 0.2s;"
      onmouseover="this.style.opacity='0.8'"
      onmouseout="this.style.opacity='1'">
      <span class="icon-link" style="margin-right: 0.25rem;"></span> <span class="copy-text">Copy Link</span>
    </button>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  function initShareButtons() {
    // Get current page URL and title
    var currentUrl = window.location.href;
    var titleEl = document.querySelector('.post-title');
    var currentTitle = titleEl ? titleEl.textContent.trim() : document.title;
    
    // Show native share button if supported
    var nativeButton = document.querySelector('.share-button-native');
    if (navigator.share && nativeButton) {
      nativeButton.style.display = 'inline-block';
    }
    
    // Remove existing event listeners to avoid duplicates
    var shareContainer = document.querySelector('.share-buttons');
    if (!shareContainer) return;
    
    // Use event delegation for all share buttons
    shareContainer.addEventListener('click', function(event) {
      var target = event.target.closest('[data-action]');
      if (!target) return;
      
      event.preventDefault();
      var action = target.getAttribute('data-action');
      
      if (action === 'share-native') {
        var text = document.querySelector('meta[name="description"]');
        var description = text ? text.content : '';
        
        if (navigator.share) {
          navigator.share({
            title: currentTitle,
            text: description,
            url: currentUrl
          }).catch(function(err) {
            if (err.name !== 'AbortError') {
              console.log('Error sharing', err);
            }
          });
        }
      } else if (action === 'share-twitter') {
        var text = encodeURIComponent(currentTitle);
        var url = encodeURIComponent(currentUrl);
        var twitterUrl = 'https://twitter.com/intent/tweet?text=' + text + '&url=' + url;
        window.open(twitterUrl, '_blank', 'noopener,noreferrer');
      } else if (action === 'share-linkedin') {
        var url = encodeURIComponent(currentUrl);
        var linkedInUrl = 'https://www.linkedin.com/sharing/share-offsite/?url=' + url;
        window.open(linkedInUrl, '_blank', 'noopener,noreferrer');
      } else if (action === 'share-whatsapp') {
        var text = encodeURIComponent(currentTitle + ' ' + currentUrl);
        var whatsappUrl = 'https://wa.me/?text=' + text;
        window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
      } else if (action === 'copy-link') {
        var copyButton = document.querySelector('.share-copy .copy-text');
        var originalText = copyButton ? copyButton.textContent : 'Copy Link';
        
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(currentUrl).then(function() {
            if (copyButton) {
              copyButton.textContent = 'Copied!';
              setTimeout(function() {
                copyButton.textContent = originalText;
              }, 2000);
            }
          }).catch(function(err) {
            console.log('Error copying', err);
            fallbackCopy(currentUrl);
          });
        } else {
          fallbackCopy(currentUrl);
        }
      }
    });
  }
  
  // Fallback copy method for older browsers
  function fallbackCopy(text) {
    var textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
      var successful = document.execCommand('copy');
      var copyButton = document.querySelector('.share-copy .copy-text');
      if (successful && copyButton) {
        var originalText = copyButton.textContent;
        copyButton.textContent = 'Copied!';
        setTimeout(function() {
          copyButton.textContent = originalText;
        }, 2000);
      } else if (!successful) {
        alert('Please copy this link manually: ' + text);
      }
    } catch (err) {
      console.log('Fallback copy failed', err);
      alert('Please copy this link manually: ' + text);
    }
    
    document.body.removeChild(textArea);
  }
  
  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initShareButtons);
  } else {
    initShareButtons();
  }
  
  // Re-initialize on Hydejack push-state navigation
  document.addEventListener('hy-push-state-load', initShareButtons);
})();
</script>

